'use strict';

exports.__esModule = true;
exports.showMessageWithLinkToTestCafeStudio = exports._dataFile = exports.NUMBER_RUNS_BETWEEN_SHOW_MESSAGE = undefined;

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

let showMessageWithLinkToTestCafeStudio = exports.showMessageWithLinkToTestCafeStudio = (() => {
    var _ref = (0, _asyncToGenerator3.default)(function* () {
        const data = yield _dataFile.load();

        // NOTE: Don't show messages in case of the IO errors
        if (!data) return;

        data.runCount++;

        const shouldDisplayMessage = data.runCount === 1 || data.runCount % NUMBER_RUNS_BETWEEN_SHOW_MESSAGE === 0;

        if (shouldDisplayMessage) {
            const targetMsg = _messages2.default[data.displayedMessageIndex];

            if (!targetMsg) {
                const message = (0, _renderTemplate2.default)(_warningMessage2.default.cannotCalculateMarketingMessage, data.displayedMessageIndex);

                DEBUG_LOGGER(message);
            }

            _log2.default.write(_os.EOL + targetMsg);

            data.displayedMessageIndex = (data.displayedMessageIndex + 1) % _messages2.default.length;
        }

        yield _dataFile.save(data);
    });

    return function showMessageWithLinkToTestCafeStudio() {
        return _ref.apply(this, arguments);
    };
})();

var _dataFile2 = require('./data-file');

var _dataFile3 = _interopRequireDefault(_dataFile2);

var _messages = require('./messages');

var _messages2 = _interopRequireDefault(_messages);

var _renderTemplate = require('../utils/render-template');

var _renderTemplate2 = _interopRequireDefault(_renderTemplate);

var _warningMessage = require('../notifications/warning-message');

var _warningMessage2 = _interopRequireDefault(_warningMessage);

var _log = require('../cli/log');

var _log2 = _interopRequireDefault(_log);

var _debug = require('debug');

var _debug2 = _interopRequireDefault(_debug);

var _os = require('os');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const NUMBER_RUNS_BETWEEN_SHOW_MESSAGE = exports.NUMBER_RUNS_BETWEEN_SHOW_MESSAGE = 10;

const DEBUG_LOGGER = (0, _debug2.default)('testcafe:marketing');

// For testing purposes
const _dataFile = exports._dataFile = new _dataFile3.default();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tYXJrZXRpbmcvaW5kZXguanMiXSwibmFtZXMiOlsiZGF0YSIsIl9kYXRhRmlsZSIsImxvYWQiLCJydW5Db3VudCIsInNob3VsZERpc3BsYXlNZXNzYWdlIiwiTlVNQkVSX1JVTlNfQkVUV0VFTl9TSE9XX01FU1NBR0UiLCJ0YXJnZXRNc2ciLCJNRVNTQUdFUyIsImRpc3BsYXllZE1lc3NhZ2VJbmRleCIsIm1lc3NhZ2UiLCJXQVJOSU5HX01FU1NBR0VTIiwiY2Fubm90Q2FsY3VsYXRlTWFya2V0aW5nTWVzc2FnZSIsIkRFQlVHX0xPR0dFUiIsImxvZyIsIndyaXRlIiwiRU9MIiwibGVuZ3RoIiwic2F2ZSIsInNob3dNZXNzYWdlV2l0aExpbmtUb1Rlc3RDYWZlU3R1ZGlvIiwiRGF0YUZpbGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7K0NBZU8sYUFBc0Q7QUFDekQsY0FBTUEsT0FBTyxNQUFNQyxVQUFVQyxJQUFWLEVBQW5COztBQUVBO0FBQ0EsWUFBSSxDQUFDRixJQUFMLEVBQ0k7O0FBRUpBLGFBQUtHLFFBQUw7O0FBRUEsY0FBTUMsdUJBQXVCSixLQUFLRyxRQUFMLEtBQWtCLENBQWxCLElBQXVCSCxLQUFLRyxRQUFMLEdBQWdCRSxnQ0FBaEIsS0FBcUQsQ0FBekc7O0FBRUEsWUFBSUQsb0JBQUosRUFBMEI7QUFDdEIsa0JBQU1FLFlBQVlDLG1CQUFTUCxLQUFLUSxxQkFBZCxDQUFsQjs7QUFFQSxnQkFBSSxDQUFDRixTQUFMLEVBQWdCO0FBQ1osc0JBQU1HLFVBQVUsOEJBQWVDLHlCQUFpQkMsK0JBQWhDLEVBQWlFWCxLQUFLUSxxQkFBdEUsQ0FBaEI7O0FBRUFJLDZCQUFhSCxPQUFiO0FBQ0g7O0FBRURJLDBCQUFJQyxLQUFKLENBQVVDLFVBQU1ULFNBQWhCOztBQUVBTixpQkFBS1EscUJBQUwsR0FBNkIsQ0FBQ1IsS0FBS1EscUJBQUwsR0FBNkIsQ0FBOUIsSUFBbUNELG1CQUFTUyxNQUF6RTtBQUNIOztBQUVELGNBQU1mLFVBQVVnQixJQUFWLENBQWVqQixJQUFmLENBQU47QUFDSCxLOztvQkExQnFCa0IsbUM7Ozs7O0FBZnRCOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBRU8sTUFBTWIsOEVBQW1DLEVBQXpDOztBQUVQLE1BQU1PLGVBQWUscUJBQU0sb0JBQU4sQ0FBckI7O0FBRUE7QUFDTyxNQUFNWCxnQ0FBWSxJQUFJa0Isa0JBQUosRUFBbEIiLCJmaWxlIjoibWFya2V0aW5nL2luZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IERhdGFGaWxlIGZyb20gJy4vZGF0YS1maWxlJztcbmltcG9ydCBNRVNTQUdFUyBmcm9tICcuL21lc3NhZ2VzJztcbmltcG9ydCByZW5kZXJUZW1wbGF0ZSBmcm9tICcuLi91dGlscy9yZW5kZXItdGVtcGxhdGUnO1xuaW1wb3J0IFdBUk5JTkdfTUVTU0FHRVMgZnJvbSAnLi4vbm90aWZpY2F0aW9ucy93YXJuaW5nLW1lc3NhZ2UnO1xuaW1wb3J0IGxvZyBmcm9tICcuLi9jbGkvbG9nJztcbmltcG9ydCBkZWJ1ZyBmcm9tICdkZWJ1Zyc7XG5pbXBvcnQgeyBFT0wgfSBmcm9tICdvcyc7XG5cbmV4cG9ydCBjb25zdCBOVU1CRVJfUlVOU19CRVRXRUVOX1NIT1dfTUVTU0FHRSA9IDEwO1xuXG5jb25zdCBERUJVR19MT0dHRVIgPSBkZWJ1ZygndGVzdGNhZmU6bWFya2V0aW5nJyk7XG5cbi8vIEZvciB0ZXN0aW5nIHB1cnBvc2VzXG5leHBvcnQgY29uc3QgX2RhdGFGaWxlID0gbmV3IERhdGFGaWxlKCk7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaG93TWVzc2FnZVdpdGhMaW5rVG9UZXN0Q2FmZVN0dWRpbyAoKSB7XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IF9kYXRhRmlsZS5sb2FkKCk7XG5cbiAgICAvLyBOT1RFOiBEb24ndCBzaG93IG1lc3NhZ2VzIGluIGNhc2Ugb2YgdGhlIElPIGVycm9yc1xuICAgIGlmICghZGF0YSlcbiAgICAgICAgcmV0dXJuO1xuXG4gICAgZGF0YS5ydW5Db3VudCsrO1xuXG4gICAgY29uc3Qgc2hvdWxkRGlzcGxheU1lc3NhZ2UgPSBkYXRhLnJ1bkNvdW50ID09PSAxIHx8IGRhdGEucnVuQ291bnQgJSBOVU1CRVJfUlVOU19CRVRXRUVOX1NIT1dfTUVTU0FHRSA9PT0gMDtcblxuICAgIGlmIChzaG91bGREaXNwbGF5TWVzc2FnZSkge1xuICAgICAgICBjb25zdCB0YXJnZXRNc2cgPSBNRVNTQUdFU1tkYXRhLmRpc3BsYXllZE1lc3NhZ2VJbmRleF07XG5cbiAgICAgICAgaWYgKCF0YXJnZXRNc2cpIHtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSByZW5kZXJUZW1wbGF0ZShXQVJOSU5HX01FU1NBR0VTLmNhbm5vdENhbGN1bGF0ZU1hcmtldGluZ01lc3NhZ2UsIGRhdGEuZGlzcGxheWVkTWVzc2FnZUluZGV4KTtcblxuICAgICAgICAgICAgREVCVUdfTE9HR0VSKG1lc3NhZ2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgbG9nLndyaXRlKEVPTCArIHRhcmdldE1zZyk7XG5cbiAgICAgICAgZGF0YS5kaXNwbGF5ZWRNZXNzYWdlSW5kZXggPSAoZGF0YS5kaXNwbGF5ZWRNZXNzYWdlSW5kZXggKyAxKSAlIE1FU1NBR0VTLmxlbmd0aDtcbiAgICB9XG5cbiAgICBhd2FpdCBfZGF0YUZpbGUuc2F2ZShkYXRhKTtcbn1cbiJdfQ==
